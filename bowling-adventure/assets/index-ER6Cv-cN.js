import{S as t,M as e,a as s,T as i,V as n,G as o,C as r,P as a,B as h,I as c,b as l,c as d,d as m,e as u,f as p,g as w,F as y,h as g,W as b,i as f,A as k,D as S,H as v}from"./three-CQZDdIZO.js";import{S as M,B as C,V as E,C as x,Q as P,a as T,M as F,b as B,W as j,c as I}from"./cannon-CMZeK6Ld.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();class D{constructor(t,e,s){this.scene=t,this.world=e,this.material=s,this.mesh=null,this.body=null,this.radius=.5,this.mass=5,this.maxSpeed=30,this.steerForce=15,this.moveForce=25}create(i){const n=new t(this.radius,32,32),o=new e({color:16729156,metalness:.4,roughness:.3,envMapIntensity:.5});this.mesh=new s(n,o),this.mesh.castShadow=!0,this.mesh.receiveShadow=!0,this.scene.add(this.mesh),this.addSwirl();const r=new M(this.radius);this.body=new C({mass:this.mass,shape:r,material:this.material,linearDamping:.3,angularDamping:.5,allowSleep:!1}),this.body.position.set(i.x,i.y,i.z),this.world.addBody(this.body),this.mesh.position.copy(this.body.position)}addSwirl(){const t=new i(.4*this.radius,.05,8,32),n=new e({color:16777215,metalness:.6,roughness:.2}),o=new s(t,n);o.rotation.x=Math.PI/2,this.mesh.add(o)}applyInput(t,e){const s=t*this.steerForce;this.body.applyForce(new E(s,0,0),this.body.position);const i=e*this.moveForce;this.body.applyForce(new E(0,0,i),this.body.position),this.enforceSpeedLimit()}enforceSpeedLimit(){const t=this.body.velocity.length();t>this.maxSpeed&&this.body.velocity.scale(this.maxSpeed/t,this.body.velocity)}update(){this.mesh.position.copy(this.body.position),this.mesh.quaternion.copy(this.body.quaternion)}getSpeed(){return this.body.velocity.length()}getPosition(){return(new n).copy(this.body.position)}reset(t){this.body.position.set(t.x,t.y,t.z),this.body.velocity.set(0,0,0),this.body.angularVelocity.set(0,0,0),this.body.quaternion.set(0,0,0,1),this.mesh.position.copy(this.body.position),this.mesh.quaternion.copy(this.body.quaternion),this.body.wakeUp()}isStopped(){return this.getSpeed()<.3}dispose(){this.mesh&&(this.scene.remove(this.mesh),this.mesh.geometry.dispose(),this.mesh.material.dispose()),this.body&&this.world.removeBody(this.body)}}class G{constructor(t,e,s){this.scene=t,this.world=e,this.material=s,this.pins=[],this.pinPositions=[],this.pinHeight=1.5,this.pinRadius=.15,this.pinMass=1.5,this.pinAreaZ=50,this.calculatePositions()}calculatePositions(){let t=0;for(let e=0;e<4;e++){const s=e+1,i=.7794*e;for(let n=0;n<s;n++){const s=.9*(n-e/2),o=this.pinAreaZ+i,r=this.pinHeight/2+.01;this.pinPositions.push({x:s,y:r,z:o,index:t++})}}}create(){this.pinPositions.forEach(t=>{const e=this.createPin(t);this.pins.push(e)})}createPin(i){const n=new o,a=new r(.7*this.pinRadius,this.pinRadius,.8*this.pinHeight,16),h=new e({color:16777215,roughness:.3,metalness:.1}),c=new s(a,h);c.position.y=.4*this.pinHeight,c.castShadow=!0,c.receiveShadow=!0,n.add(c);const l=new r(.4*this.pinRadius,.7*this.pinRadius,.15*this.pinHeight,16),d=new s(l,h);d.position.y=.85*this.pinHeight,d.castShadow=!0,n.add(d);const m=new t(.5*this.pinRadius,16,16),u=new s(m,h);u.position.y=.95*this.pinHeight,u.castShadow=!0,n.add(u);const p=new r(.72*this.pinRadius,1.02*this.pinRadius,.08,16),w=new e({color:16711680,roughness:.3,metalness:.1}),y=new s(p,w);y.position.y=.25*this.pinHeight,n.add(y);const g=new s(p,w);g.position.y=.35*this.pinHeight,n.add(g),n.position.set(i.x,0,i.z),this.scene.add(n);const b=new x(.7*this.pinRadius,this.pinRadius,this.pinHeight,8),f=new C({mass:this.pinMass,material:this.material,linearDamping:.4,angularDamping:.4}),k=new P;return k.setFromAxisAngle(new E(1,0,0),0),f.addShape(b,new E(0,this.pinHeight/2,0),k),f.position.set(i.x,i.y,i.z),this.world.addBody(f),{mesh:n,body:f,originalPosition:{...i},knocked:!1}}update(){this.pins.forEach(t=>{t.mesh.position.copy(t.body.position),t.mesh.position.y-=this.pinHeight/2,t.mesh.quaternion.copy(t.body.quaternion),t.knocked||(t.knocked=this.isPinKnocked(t))})}isPinKnocked(t){const e=new n(0,1,0);e.applyQuaternion(t.mesh.quaternion);return e.dot(new n(0,1,0))<.707}countKnockedDown(){return this.pins.filter(t=>this.isPinKnocked(t)).length}countStanding(){return 10-this.countKnockedDown()}resetAll(){this.pins.forEach(t=>{const e=t.originalPosition;t.body.position.set(e.x,e.y,e.z),t.body.velocity.set(0,0,0),t.body.angularVelocity.set(0,0,0),t.body.quaternion.set(0,0,0,1),t.body.wakeUp(),t.mesh.position.set(e.x,0,e.z),t.mesh.quaternion.set(0,0,0,1),t.knocked=!1,t.mesh.visible=!0})}clearKnockedPins(){this.pins.forEach(t=>{this.isPinKnocked(t)&&(t.body.position.set(100,-100,100),t.body.velocity.set(0,0,0),t.body.sleep(),t.mesh.visible=!1)})}getStatus(){return{total:this.pins.length,standing:this.countStanding(),knocked:this.countKnockedDown()}}dispose(){this.pins.forEach(t=>{this.scene.remove(t.mesh),t.mesh.traverse(t=>{t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()}),this.world.removeBody(t.body)}),this.pins=[]}}class L{constructor(){this.input={x:0,y:0},this.mode="joystick",this.gyroAvailable=!1,this.gyroPermissionGranted=!1,this.gyroSensitivity=3.5,this.gyroDeadzone=.05,this.gyroBeta=0,this.gyroGamma=0,this.joystickContainer=null,this.joystickKnob=null,this.joystickActive=!1,this.joystickCenter={x:0,y:0},this.joystickRadius=50,this.toggleButton=null}init(){this.setupJoystick(),this.checkGyroAvailability(),this.setupToggle()}setupJoystick(){this.joystickContainer=document.getElementById("joystick-container"),this.joystickKnob=document.getElementById("joystick-knob"),this.joystickContainer&&this.joystickKnob&&(this.joystickContainer.addEventListener("touchstart",t=>this.onJoystickStart(t),{passive:!1}),this.joystickContainer.addEventListener("touchmove",t=>this.onJoystickMove(t),{passive:!1}),this.joystickContainer.addEventListener("touchend",t=>this.onJoystickEnd(t)),this.joystickContainer.addEventListener("touchcancel",t=>this.onJoystickEnd(t)),this.joystickContainer.addEventListener("mousedown",t=>this.onJoystickStart(t)),window.addEventListener("mousemove",t=>this.onJoystickMove(t)),window.addEventListener("mouseup",t=>this.onJoystickEnd(t)),this.updateJoystickDimensions(),window.addEventListener("resize",()=>this.updateJoystickDimensions()))}updateJoystickDimensions(){if(!this.joystickContainer)return;const t=this.joystickContainer.getBoundingClientRect();this.joystickCenter={x:t.left+t.width/2,y:t.top+t.height/2},this.joystickRadius=t.width/2-25}onJoystickStart(t){"joystick"===this.mode&&(t.preventDefault(),this.joystickActive=!0,this.updateJoystickDimensions(),this.onJoystickMove(t))}onJoystickMove(t){if(!this.joystickActive||"joystick"!==this.mode)return;let e,s;t.preventDefault(),t.touches&&t.touches.length>0?(e=t.touches[0].clientX,s=t.touches[0].clientY):(e=t.clientX,s=t.clientY);let i=e-this.joystickCenter.x,n=s-this.joystickCenter.y;const o=Math.sqrt(i*i+n*n);o>this.joystickRadius&&(i=i/o*this.joystickRadius,n=n/o*this.joystickRadius),this.joystickKnob.style.marginLeft=`${-25+i}px`,this.joystickKnob.style.marginTop=`${-25+n}px`,this.input.x=i/this.joystickRadius,this.input.y=-n/this.joystickRadius}onJoystickEnd(t){"joystick"===this.mode&&(this.joystickActive=!1,this.joystickKnob&&(this.joystickKnob.style.marginLeft="-25px",this.joystickKnob.style.marginTop="-25px"),this.input.x=0,this.input.y=0)}checkGyroAvailability(){if(window.DeviceOrientationEvent)if("function"==typeof DeviceOrientationEvent.requestPermission)this.gyroAvailable=!0;else{const t=e=>{null===e.beta&&null===e.gamma||(this.gyroAvailable=!0,this.gyroPermissionGranted=!0,this.setupGyro()),window.removeEventListener("deviceorientation",t)};window.addEventListener("deviceorientation",t,{once:!0}),setTimeout(()=>{window.removeEventListener("deviceorientation",t)},1e3)}}async requestGyroPermission(){if(!window.DeviceOrientationEvent)return console.log("DeviceOrientation not supported"),!1;try{if("function"==typeof DeviceOrientationEvent.requestPermission){return"granted"===await DeviceOrientationEvent.requestPermission()?(this.gyroPermissionGranted=!0,this.setupGyro(),!0):(console.log("Gyro permission denied"),!1)}return this.gyroPermissionGranted=!0,this.setupGyro(),!0}catch(t){return console.log("Error requesting gyro permission:",t),!1}}setupGyro(){window.addEventListener("deviceorientation",t=>this.onDeviceOrientation(t))}onDeviceOrientation(t){if("gyro"!==this.mode)return;this.gyroBeta=t.beta||0,this.gyroGamma=t.gamma||0;let e=this.gyroBeta/45;e=Math.max(-1,Math.min(1,e*this.gyroSensitivity));let s=this.gyroGamma/45;s=Math.max(-1,Math.min(1,s*this.gyroSensitivity)),Math.abs(s)<this.gyroDeadzone&&(s=0),Math.abs(e)<this.gyroDeadzone&&(e=0),this.input.x=s,this.input.y=e}setupToggle(){this.toggleButton=document.getElementById("control-toggle"),this.toggleButton&&(this.toggleButton.addEventListener("click",async()=>{await this.toggleMode()}),this.updateToggleButton())}async toggleMode(){if("joystick"===this.mode)if(this.gyroPermissionGranted)this.mode="gyro",this.hideJoystick();else if(this.gyroAvailable){await this.requestGyroPermission()&&(this.mode="gyro",this.hideJoystick())}else console.log("Gyro not available on this device");else this.mode="joystick",this.showJoystick(),this.input={x:0,y:0};this.updateToggleButton()}updateToggleButton(){this.toggleButton&&("gyro"===this.mode?this.toggleButton.textContent="Tilt":this.toggleButton.textContent="Joystick")}showJoystick(){this.joystickContainer&&(this.joystickContainer.style.display="block")}hideJoystick(){this.joystickContainer&&(this.joystickContainer.style.display="none")}getInput(){return{...this.input}}getMode(){return this.mode}isGyroAvailable(){return this.gyroAvailable}}class R{constructor(t,e,s){this.scene=t,this.world=e,this.materials=s,this.width=8,this.length=60,this.sections=[],this.obstacles=[]}create(){this.createGround(),this.createWalls(),this.createTerrainSections(),this.createObstacles(),this.createPinArea(),this.createSkybox()}createGround(){const t=new a(this.width,this.length),i=new e({color:4881497,roughness:.8,metalness:.1}),n=new s(t,i);n.rotation.x=-Math.PI/2,n.position.set(0,0,this.length/2),n.receiveShadow=!0,this.scene.add(n);const o=new T(new E(this.width/2,.1,this.length/2)),r=new C({mass:0,shape:o,material:this.materials.ground});r.position.set(0,-.1,this.length/2),this.world.addBody(r),this.ground={mesh:n,body:r}}createWalls(){const t=.5,i=.3,n=new e({color:9127187,roughness:.7}),o=new h(i,t,this.length),r=new s(o,n);r.position.set(-this.width/2-.15,.25,this.length/2),r.castShadow=!0,r.receiveShadow=!0,this.scene.add(r);const a=new T(new E(.15,.25,this.length/2)),c=new C({mass:0,shape:a,material:this.materials.wall});c.position.copy(r.position),this.world.addBody(c);const l=new s(o,n);l.position.set(this.width/2+.15,.25,this.length/2),l.castShadow=!0,l.receiveShadow=!0,this.scene.add(l);const d=new C({mass:0,shape:a,material:this.materials.wall});d.position.copy(l.position),this.world.addBody(d)}createTerrainSections(){this.createTerrainSection({start:15,end:25,color:12759680,friction:.8,restitution:.1,name:"sand"}),this.createTerrainSection({start:35,end:45,color:11393254,friction:.05,restitution:.4,name:"ice"})}createTerrainSection(t){const i=t.end-t.start,n=new a(this.width-.1,i),o=new e({color:t.color,roughness:"ice"===t.name?.1:.9,metalness:"ice"===t.name?.3:0,transparent:!0,opacity:.8}),r=new s(n,o);r.rotation.x=-Math.PI/2,r.position.set(0,.01,t.start+i/2),r.receiveShadow=!0,this.scene.add(r);const h=new F(t.name);this.materials[t.name]=h;const c=new T(new E(this.width/2,.1,i/2)),l=new C({mass:0,shape:c,material:h});l.position.set(0,-.05,t.start+i/2),this.world.addBody(l);const d=new B(this.materials.ball,h,{friction:t.friction,restitution:t.restitution});this.world.addContactMaterial(d),this.sections.push({mesh:r,body:l,config:t})}createObstacles(){this.createRock(new n(-2,0,20),.8),this.createRock(new n(2.5,0,28),.6),this.createRock(new n(-1.5,0,40),.7),this.createRock(new n(1,0,32),.5),this.createBarrier(new n(0,0,12),3,.5,0),this.createBarrier(new n(-1.5,0,47),2,.3,Math.PI/6),this.createBarrier(new n(1.5,0,47),2,.3,-Math.PI/6)}createRock(t,i){const n=new c(i,0),o=new e({color:6710886,roughness:.9,flatShading:!0}),r=new s(n,o);r.position.copy(t),r.position.y=.8*i,r.rotation.set(Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI),r.castShadow=!0,r.receiveShadow=!0,this.scene.add(r);const a=new M(i),h=new C({mass:0,shape:a,material:this.materials.wall});h.position.set(t.x,i,t.z),this.world.addBody(h),this.obstacles.push({mesh:r,body:h,type:"rock"})}createBarrier(t,i,n,o){const r=new h(i,n,.3),a=new e({color:9127187,roughness:.7}),c=new s(r,a);c.position.copy(t),c.position.y=n/2,c.rotation.y=o,c.castShadow=!0,c.receiveShadow=!0,this.scene.add(c);const l=new T(new E(i/2,n/2,.15)),d=new C({mass:0,shape:l,material:this.materials.wall});d.position.copy(c.position),d.quaternion.setFromEuler(0,o,0),this.world.addBody(d),this.obstacles.push({mesh:c,body:d,type:"barrier"})}createPinArea(){const t=new a(this.width,10),i=new e({color:6636321,roughness:.6}),n=new s(t,i);n.rotation.x=-Math.PI/2,n.position.set(0,.02,55),n.receiveShadow=!0,this.scene.add(n)}createSkybox(){const e=new t(200,32,32),i=new l({color:8900331,side:d}),n=new s(e,i);this.scene.add(n),this.createClouds(),this.createHills()}createClouds(){const e=new l({color:16777215,transparent:!0,opacity:.8});for(let i=0;i<8;i++){const i=new o,n=3+Math.floor(3*Math.random());for(let o=0;o<n;o++){const r=3+4*Math.random(),a=new t(r,8,8),h=new s(a,e);h.position.set(3*(o-n/2),2*Math.random(),2*Math.random()),i.add(h)}i.position.set(150*(Math.random()-.5),30+20*Math.random(),100*Math.random()),this.scene.add(i)}}createHills(){const t=new e({color:2263842,roughness:.9});for(let e=0;e<5;e++){const e=new m(20+15*Math.random(),15+10*Math.random(),8),i=new s(e,t);i.position.set(100*(Math.random()-.5),-5,80+40*Math.random()),i.rotation.y=Math.random()*Math.PI,this.scene.add(i)}}getTerrainAt(t){for(const e of this.sections)if(t>=e.config.start&&t<=e.config.end)return e.config.name;return"normal"}}class A{constructor(){this.frames=[],this.reset()}reset(){this.frames=Array(10).fill(null).map(()=>({throws:[],score:null,bonus:null})),this.currentFrame=0}recordThrow(t){const e=this.frames[this.currentFrame],s=this.getMaxPinsForThrow();t=Math.min(Math.max(0,t),s),e.throws.push(t),this.currentFrame<9?10===e.throws[0]?(e.bonus="strike",this.currentFrame++):2===e.throws.length&&(e.throws[0]+e.throws[1]===10&&(e.bonus="spare"),this.currentFrame++):this.handle10thFrame(e),this.calculateScores()}getMaxPinsForThrow(){const t=this.frames[this.currentFrame];if(this.currentFrame<9)return 0===t.throws.length?10:10-t.throws[0];{const e=t.throws;if(0===e.length)return 10;if(1===e.length)return 10===e[0]?10:10-e[0];if(2===e.length)return 10===e[0]&&10===e[1]?10:10===e[0]?10-e[1]:e[0]+e[1]===10?10:0}return 0}handle10thFrame(t){const e=t.throws;1===e.length?10===e[0]&&(t.bonus="strike"):2===e.length?10===e[0]?e[1]:e[0]+e[1]===10?t.bonus="spare":this.currentFrame++:3===e.length&&this.currentFrame++}calculateScores(){let t=0;for(let e=0;e<10;e++){const s=this.frames[e];if(0===s.throws.length)continue;let i=this.getFrameBaseScore(e);if(e<9)if("strike"===s.bonus){i+=this.getNextThrows(e,2).reduce((t,e)=>t+e,0)}else if("spare"===s.bonus){i+=this.getNextThrows(e,1)[0]||0}this.canScoreFrame(e)&&(t+=i,s.score=t)}}getFrameBaseScore(t){return this.frames[t].throws.reduce((t,e)=>t+e,0)}getNextThrows(t,e){const s=[];for(let i=t+1;i<10&&s.length<e;i++)s.push(...this.frames[i].throws);return s.slice(0,e)}canScoreFrame(t){const e=this.frames[t];return 9===t?10===e.throws[0]||e.throws[0]+(e.throws[1]||0)===10?e.throws.length>=3:e.throws.length>=2:"strike"===e.bonus?this.getNextThrows(t,2).length>=2:"spare"===e.bonus?this.getNextThrows(t,1).length>=1:e.throws.length>=2}isFrameComplete(t){const e=this.frames[t];if(t<9)return 10===e.throws[0]||e.throws.length>=2;{const t=e.throws;return t.length>=3||2===t.length&&10!==t[0]&&t[0]+t[1]!==10}}getTotalScore(){let t=0;for(const e of this.frames)null!==e.score&&(t=e.score);return t}getFrames(){return this.frames.map((t,e)=>({number:e+1,throws:[...t.throws],score:t.score,bonus:t.bonus,is10th:9===e}))}getCurrentFrame(){return this.currentFrame}isGameComplete(){return this.currentFrame>=10}static formatThrow(t,e=!1,s=0){return 10!==t||e?e&&s+t===10?"/":0===t?"-":t.toString():"X"}}class H{constructor(t){this.game=t,this.frameDisplay=document.getElementById("frame-display"),this.throwDisplay=document.getElementById("throw-display"),this.scoreDisplay=document.getElementById("score-display"),this.speedGauge=document.getElementById("speed-gauge"),this.finalScore=document.getElementById("final-score"),this.scoreboard=document.getElementById("scoreboard"),this.hud=document.getElementById("hud"),this.speedGaugeContainer=document.getElementById("speed-gauge-container"),this.controlToggle=document.getElementById("control-toggle"),this.joystickContainer=document.getElementById("joystick-container"),this.screens={title:document.getElementById("title-screen"),loading:document.getElementById("loading-screen"),result:document.getElementById("result-screen")}}showHUD(){this.hud&&(this.hud.style.display="flex"),this.speedGaugeContainer&&(this.speedGaugeContainer.style.display="block"),this.controlToggle&&(this.controlToggle.style.display="block"),this.joystickContainer&&(this.joystickContainer.style.display="block")}hideHUD(){this.hud&&(this.hud.style.display="none"),this.speedGaugeContainer&&(this.speedGaugeContainer.style.display="none"),this.controlToggle&&(this.controlToggle.style.display="none"),this.joystickContainer&&(this.joystickContainer.style.display="none")}updateFrame(t,e){this.frameDisplay&&(this.frameDisplay.textContent=`Frame: ${t} / 10`),this.throwDisplay&&(this.throwDisplay.textContent=`Throw: ${e}`)}updateScore(t){this.scoreDisplay&&(this.scoreDisplay.textContent=t.toString())}updateSpeedGauge(t){if(this.speedGauge){const e=Math.min(100,Math.max(0,100*t));this.speedGauge.style.height=`${e}%`}}showScreen(t){const e=document.getElementById(t);e&&e.classList.remove("hidden")}hideScreen(t){const e=document.getElementById(t);e&&e.classList.add("hidden")}showLoading(){this.showScreen("loading-screen")}hideLoading(){this.hideScreen("loading-screen")}showResults(t,e){this.hideHUD(),this.finalScore&&(this.finalScore.textContent=t.toString()),this.scoreboard&&this.buildScoreboard(e),this.showScreen("result-screen")}buildScoreboard(t){this.scoreboard&&(this.scoreboard.innerHTML="",t.forEach((t,e)=>{const s=document.createElement("div");s.className="frame-box";const i=document.createElement("div");i.className="frame-number",i.textContent=t.number.toString(),s.appendChild(i);const n=document.createElement("div");if(n.className="frame-throws",t.is10th){const e=t.throws.map((e,s)=>10===e?(0===s||10===t.throws[s-1]||1===s&&t.throws[0],"X"):s>0&&10!==t.throws[s-1]&&t.throws[s-1]+e===10?"/":0===e?"-":e.toString());n.textContent=e.join(" ")}else{const e=t.throws.map((e,s)=>A.formatThrow(e,1===s,t.throws[0]||0));n.textContent=e.join(" ")}s.appendChild(n);const o=document.createElement("div");o.className="frame-score",o.textContent=null!==t.score?t.score.toString():"",s.appendChild(o),this.scoreboard.appendChild(s)}))}showMessage(t,e=2e3){const s=document.createElement("div");s.style.cssText="\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      background: rgba(0,0,0,0.8);\n      color: white;\n      padding: 20px 40px;\n      border-radius: 10px;\n      font-size: 24px;\n      font-weight: bold;\n      z-index: 1000;\n      animation: fadeIn 0.3s ease-out;\n    ",s.textContent=t,document.body.appendChild(s),setTimeout(()=>{s.style.animation="fadeOut 0.3s ease-out",setTimeout(()=>{document.body.removeChild(s)},300)},e)}showStrike(){this.showMessage("STRIKE!",1500)}showSpare(){this.showMessage("SPARE!",1500)}showGutter(){this.showMessage("Gutter Ball!",1e3)}}class J{constructor(){this.state="title",this.paused=!1,this.currentFrame=0,this.currentThrow=0,this.lastPinCount=10,this.scene=null,this.camera=null,this.renderer=null,this.clock=new u,this.world=null,this.materials={},this.ball=null,this.pins=null,this.course=null,this.controls=null,this.ui=null,this.scoreManager=new A,this.cameraOffset=new n(0,8,-12),this.cameraLookOffset=new n(0,0,10),this.ballStartPosition=new n(0,1,0),this.ballStopped=!1,this.ballStopTimer=0,this.pinSettleTimer=0,this.init()}init(){this.initRenderer(),this.initPhysics(),this.initScene(),this.initEntities(),this.initControls(),this.initUI(),this.setupEventListeners(),this.animate()}initRenderer(){const t=document.getElementById("game-container");this.scene=new p,this.scene.background=new w(8900331),this.scene.fog=new y(8900331,50,200),this.camera=new g(60,window.innerWidth/window.innerHeight,.1,500),this.camera.position.set(0,10,-15),this.camera.lookAt(0,0,20),this.renderer=new b({antialias:!0,powerPreference:"high-performance"}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=f,t.insertBefore(this.renderer.domElement,t.firstChild),window.addEventListener("resize",()=>this.onResize())}initPhysics(){this.world=new j,this.world.gravity.set(0,-9.82,0),this.world.broadphase=new I(this.world),this.world.solver.iterations=10,this.world.allowSleep=!0,this.materials.ball=new F("ball"),this.materials.ground=new F("ground"),this.materials.pin=new F("pin"),this.materials.wall=new F("wall"),this.world.addContactMaterial(new B(this.materials.ball,this.materials.ground,{friction:.3,restitution:.3})),this.world.addContactMaterial(new B(this.materials.ball,this.materials.pin,{friction:.5,restitution:.6})),this.world.addContactMaterial(new B(this.materials.ball,this.materials.wall,{friction:.3,restitution:.4})),this.world.addContactMaterial(new B(this.materials.pin,this.materials.ground,{friction:.8,restitution:.2})),this.world.addContactMaterial(new B(this.materials.pin,this.materials.pin,{friction:.5,restitution:.3}))}initScene(){const t=new k(16777215,.6);this.scene.add(t);const e=new S(16777215,.8);e.position.set(30,50,30),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.camera.near=1,e.shadow.camera.far=150,e.shadow.camera.left=-50,e.shadow.camera.right=50,e.shadow.camera.top=50,e.shadow.camera.bottom=-50,this.scene.add(e);const s=new v(8900331,10017165,.3);this.scene.add(s)}initEntities(){this.course=new R(this.scene,this.world,this.materials),this.course.create(),this.ball=new D(this.scene,this.world,this.materials.ball),this.ball.create(this.ballStartPosition),this.pins=new G(this.scene,this.world,this.materials.pin),this.pins.create()}initControls(){this.controls=new L,this.controls.init()}initUI(){this.ui=new H(this)}setupEventListeners(){var t,e,s;null==(t=document.getElementById("start-btn"))||t.addEventListener("click",()=>{this.startGame()}),null==(e=document.getElementById("restart-btn"))||e.addEventListener("click",()=>{this.restartGame()}),null==(s=document.getElementById("control-toggle"))||s.addEventListener("click",()=>{this.controls.toggleMode()})}startGame(){this.state="playing",this.currentFrame=0,this.currentThrow=0,this.lastPinCount=10,this.scoreManager.reset(),this.resetForThrow(),this.ui.hideScreen("title-screen"),this.ui.showHUD()}restartGame(){this.ui.hideScreen("result-screen"),this.startGame()}resetForThrow(){this.ball.reset(this.ballStartPosition),this.ballStopped=!1,this.ballStopTimer=0,this.state="playing",this.camera.position.copy(this.ballStartPosition).add(this.cameraOffset),this.camera.lookAt(this.ballStartPosition.clone().add(this.cameraLookOffset))}resetPinsForNewFrame(){this.pins.resetAll(),this.lastPinCount=10}endThrow(){const t=this.pins.countKnockedDown(),e=t-(10-this.lastPinCount);if(this.lastPinCount=10-t,this.scoreManager.recordThrow(e),this.ui.updateScore(this.scoreManager.getTotalScore()),this.ui.updateFrame(this.currentFrame+1,this.currentThrow+1),this.scoreManager.isFrameComplete(this.currentFrame)){if(this.currentThrow=0,this.currentFrame++,this.currentFrame>=10)return void this.endGame();this.resetPinsForNewFrame()}else this.currentThrow++,this.pins.clearKnockedPins();this.resetForThrow()}endGame(){this.state="result",this.ui.showResults(this.scoreManager.getTotalScore(),this.scoreManager.getFrames())}pause(){this.paused=!0}resume(){this.paused=!1,this.clock.getDelta()}onResize(){const t=window.innerWidth,e=window.innerHeight;this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,e)}animate(){if(requestAnimationFrame(()=>this.animate()),this.paused)return;const t=Math.min(this.clock.getDelta(),.1);this.world.step(1/60,t,3),this.update(t),this.renderer.render(this.scene,this.camera)}update(t){if("playing"!==this.state&&"throwing"!==this.state&&"waiting"!==this.state)return;const e=this.controls.getInput();if("playing"!==this.state&&"throwing"!==this.state||(0===e.x&&0===e.y||(this.state="throwing",this.ball.applyInput(e.x,e.y)),this.ball.update(),this.updateCamera(),this.ui.updateSpeedGauge(this.ball.getSpeed()/this.ball.maxSpeed)),"throwing"===this.state){const e=this.ball.getSpeed();if(this.ball.getPosition().y<-5)return this.scoreManager.recordThrow(0),void this.handleFallOff();e<.5?(this.ballStopTimer+=t,this.ballStopTimer>1.5&&(this.state="waiting",this.pinSettleTimer=0)):this.ballStopTimer=0}"waiting"===this.state&&(this.pinSettleTimer+=t,this.pinSettleTimer>2&&this.endThrow()),this.pins.update()}handleFallOff(){if(this.scoreManager.isFrameComplete(this.currentFrame)){if(this.currentThrow=0,this.currentFrame++,this.currentFrame>=10)return void this.endGame();this.resetPinsForNewFrame()}else this.currentThrow++,this.pins.clearKnockedPins();this.resetForThrow()}updateCamera(){const t=this.ball.getPosition(),e=t.clone().add(this.cameraOffset);this.camera.position.lerp(e,.05);const s=t.clone().add(this.cameraLookOffset),i=new n;this.camera.getWorldDirection(i);const o=s.clone().sub(this.camera.position).normalize();i.lerp(o,.05),this.camera.lookAt(this.camera.position.clone().add(i.multiplyScalar(10)))}}document.addEventListener("DOMContentLoaded",()=>{const t=new J;window.game=t,document.addEventListener("visibilitychange",()=>{document.hidden?t.pause():t.resume()}),console.log("Bowling Adventure - Simple Integrated Architecture"),console.log("Version: 1.0.0")});
