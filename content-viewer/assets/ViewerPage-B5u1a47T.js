import{c as L,j as e,L as B,X as K,u as q,a as _,F as A}from"./index-N1P5ay2K.js";import{r as t,u as Y,d as H}from"./router-DZPHsDLW.js";import{P as G}from"./play-BJpg_A95.js";import{p as J,a as Q}from"./firestore-g5Y3pXIM.js";import"./firebase-B_HbBKsG.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=L("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=L("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=L("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=L("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=L("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=L("Minimize",[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=L("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=L("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=L("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),I=t.createContext(null);function $(){const o=t.useContext(I);if(!o)throw new Error("useViewer must be used within a ViewerProvider");return o}const le={isPlaying:!1,isLoading:!1,currentTime:0,duration:0,volume:1,playbackRate:1,isFullscreen:!1,showOverlay:!0,showSeekbar:!0},ie=3e3;function ce({children:o,audioUrl:l}){const[s,n]=t.useState(le),r=t.useRef(null),y=t.useRef(null),b=t.useRef(null);t.useEffect(()=>{if(!l)return;const a=new Audio(l);r.current=a;const v=localStorage.getItem("viewer-volume");v&&(a.volume=parseFloat(v),n(x=>({...x,volume:parseFloat(v)})));const N=localStorage.getItem("viewer-playback-rate");N&&(a.playbackRate=parseFloat(N),n(x=>({...x,playbackRate:parseFloat(N)})));const M=()=>n(x=>({...x,isLoading:!0})),S=()=>n(x=>({...x,isLoading:!1})),T=()=>n(x=>({...x,duration:a.duration})),P=()=>n(x=>({...x,currentTime:a.currentTime})),R=()=>n(x=>({...x,isPlaying:!0})),F=()=>n(x=>({...x,isPlaying:!1})),V=()=>n(x=>({...x,isPlaying:!1}));return a.addEventListener("loadstart",M),a.addEventListener("canplay",S),a.addEventListener("loadedmetadata",T),a.addEventListener("timeupdate",P),a.addEventListener("play",R),a.addEventListener("pause",F),a.addEventListener("ended",V),()=>{a.pause(),a.removeEventListener("loadstart",M),a.removeEventListener("canplay",S),a.removeEventListener("loadedmetadata",T),a.removeEventListener("timeupdate",P),a.removeEventListener("play",R),a.removeEventListener("pause",F),a.removeEventListener("ended",V)}},[l]),t.useEffect(()=>{const a=()=>{n(v=>({...v,isFullscreen:!!document.fullscreenElement}))};return document.addEventListener("fullscreenchange",a),document.addEventListener("webkitfullscreenchange",a),()=>{document.removeEventListener("fullscreenchange",a),document.removeEventListener("webkitfullscreenchange",a)}},[]);const c=t.useCallback(()=>{y.current&&clearTimeout(y.current),y.current=window.setTimeout(()=>{s.isPlaying&&n(a=>({...a,showOverlay:!1}))},ie)},[s.isPlaying]),i=t.useCallback(async()=>{if(r.current)try{await r.current.play(),c()}catch(a){console.error("Play failed:",a)}},[c]),d=t.useCallback(()=>{r.current&&r.current.pause()},[]),u=t.useCallback(()=>{s.isPlaying?d():i()},[s.isPlaying,i,d]),h=t.useCallback(a=>{r.current&&(r.current.currentTime=Math.max(0,Math.min(a,s.duration)))},[s.duration]),k=t.useCallback(a=>{const v=Math.max(0,Math.min(1,a));r.current&&(r.current.volume=v),n(N=>({...N,volume:v})),localStorage.setItem("viewer-volume",v.toString())},[]),g=t.useCallback(a=>{const v=Math.max(.5,Math.min(2,a));r.current&&(r.current.playbackRate=v),n(N=>({...N,playbackRate:v})),localStorage.setItem("viewer-playback-rate",v.toString())},[]),p=t.useCallback(async()=>{const a=b.current||document.documentElement;try{a.requestFullscreen?await a.requestFullscreen():a.webkitRequestFullscreen&&await a.webkitRequestFullscreen()}catch(v){console.error("Fullscreen failed:",v)}},[]),m=t.useCallback(async()=>{try{document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen&&await document.webkitExitFullscreen()}catch(a){console.error("Exit fullscreen failed:",a)}},[]),w=t.useCallback(()=>{s.isFullscreen?m():p()},[s.isFullscreen,p,m]),j=t.useCallback(()=>{n(a=>({...a,showOverlay:!0})),c()},[c]),f=t.useCallback(()=>{n(a=>({...a,showOverlay:!1}))},[]),E=t.useCallback(()=>{n(a=>({...a,showSeekbar:!a.showSeekbar}))},[]),C={...s,play:i,pause:d,toggle:u,seek:h,setVolume:k,setPlaybackRate:g,enterFullscreen:p,exitFullscreen:m,toggleFullscreen:w,showControls:j,hideControls:f,toggleSeekbar:E};return e.jsx(I.Provider,{value:C,children:o})}function ue(o,l={}){const{enabled:s=!0}=l,[n,r]=t.useState(s),y=t.useCallback(d=>{if(!n)return;const u=d.target;if(!(u.tagName==="INPUT"||u.tagName==="TEXTAREA"||u.isContentEditable))for(const h of o){const k=d.key.toLowerCase()===h.key.toLowerCase(),g=!!h.ctrl===(d.ctrlKey||d.metaKey),p=!!h.shift===d.shiftKey,m=!!h.alt===d.altKey;if(k&&g&&p&&m){d.preventDefault(),h.action();return}}},[o,n]);t.useEffect(()=>(document.addEventListener("keydown",y),()=>{document.removeEventListener("keydown",y)}),[y]);const b=t.useCallback(()=>r(!0),[]),c=t.useCallback(()=>r(!1),[]),i=t.useCallback(d=>o.filter(u=>u.category===d),[o]);return{shortcuts:o,isEnabled:n,enable:b,disable:c,getShortcutsByCategory:i}}const U=300;function de(o={}){const{threshold:l=50,onSwipeLeft:s,onSwipeRight:n,onSwipeUp:r,onSwipeDown:y,onTap:b,onDoubleTap:c}=o,i=t.useRef(null),[d,u]=t.useState(!1),[h,k]=t.useState(null),g=t.useRef({startX:0,startY:0,endX:0,endY:0}),p=t.useRef(0),m=t.useRef(null);return t.useEffect(()=>{const w=i.current;if(!w)return;const j=C=>{const a=C.touches[0];g.current={startX:a.clientX,startY:a.clientY,endX:a.clientX,endY:a.clientY},u(!0),k(null)},f=C=>{const a=C.touches[0];g.current.endX=a.clientX,g.current.endY=a.clientY},E=()=>{u(!1);const{startX:C,startY:a,endX:v,endY:N}=g.current,M=v-C,S=N-a,T=Math.abs(M),P=Math.abs(S);if(T>l||P>l)T>P?M>0?(k("right"),n?.()):(k("left"),s?.()):S>0?(k("down"),y?.()):(k("up"),r?.());else{const R=Date.now();R-p.current<U&&m.current?(clearTimeout(m.current),m.current=null,c?.()):m.current=window.setTimeout(()=>{b?.(),m.current=null},U),p.current=R}};return w.addEventListener("touchstart",j,{passive:!0}),w.addEventListener("touchmove",f,{passive:!0}),w.addEventListener("touchend",E,{passive:!0}),()=>{w.removeEventListener("touchstart",j),w.removeEventListener("touchmove",f),w.removeEventListener("touchend",E),m.current&&clearTimeout(m.current)}},[l,s,n,r,y,b,c]),{ref:i,isPressed:d,swipeDirection:h}}function he({htmlUrl:o,className:l=""}){const s=t.useRef(null),[n,r]=t.useState(!0),[y,b]=t.useState(null);t.useEffect(()=>{r(!0),b(null)},[o]);const c=()=>{r(!1)},i=()=>{r(!1),b("Failed to load slide content")};return e.jsxs("div",{className:`relative w-full h-full bg-dark-950 ${l}`,children:[n&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-dark-900",children:e.jsx(B,{size:"lg"})}),y&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-dark-900",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-400 mb-2",children:y}),e.jsx("button",{onClick:()=>{b(null),r(!0),s.current&&(s.current.src=o)},className:"text-primary-400 hover:text-primary-300 underline",children:"Retry"})]})}),e.jsx("iframe",{ref:s,src:o,className:`w-full h-full border-0 ${n||y?"invisible":"visible"}`,sandbox:"allow-scripts allow-same-origin",title:"Slide content",onLoad:c,onError:i,loading:"lazy"})]})}function D(o){const l=Math.floor(o/60),s=Math.floor(o%60);return`${l}:${s.toString().padStart(2,"0")}`}function me({collapsed:o=!1,onToggle:l}){const{currentTime:s,duration:n,seek:r,isPlaying:y}=$(),b=t.useRef(null),[c,i]=t.useState(!1),d=n>0?s/n*100:0,u=0,h=t.useCallback(f=>{if(!b.current||n===0)return;const E=b.current.getBoundingClientRect(),C=f-E.left,a=Math.max(0,Math.min(1,C/E.width));r(a*n)},[n,r]),k=f=>{i(!0),h(f.clientX)},g=t.useCallback(f=>{c&&h(f.clientX)},[c,h]),p=t.useCallback(()=>{i(!1)},[]);t.useState(()=>{if(c)return document.addEventListener("mousemove",g),document.addEventListener("mouseup",p),()=>{document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",p)}});const m=f=>{i(!0),h(f.touches[0].clientX)},w=f=>{c&&h(f.touches[0].clientX)},j=()=>{i(!1)};return o?e.jsx("button",{onClick:l,className:"fixed bottom-0 left-0 right-0 h-8 bg-dark-800/90 backdrop-blur-sm flex items-center justify-center text-gray-400 hover:text-white transition-colors","aria-label":"Expand seekbar",children:e.jsx(te,{className:"w-5 h-5"})}):e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-dark-800/90 backdrop-blur-sm px-4 py-3",role:"group","aria-label":"Audio playback controls",children:[e.jsx("button",{onClick:l,className:"absolute -top-6 left-1/2 -translate-x-1/2 p-1 bg-dark-800/90 rounded-t-lg text-gray-400 hover:text-white transition-colors","aria-label":"Collapse seekbar",children:e.jsx(W,{className:"w-4 h-4"})}),e.jsxs("div",{ref:b,className:"relative h-2 bg-dark-600 rounded-full cursor-pointer group",onMouseDown:k,onTouchStart:m,onTouchMove:w,onTouchEnd:j,role:"slider","aria-label":"Audio progress","aria-valuemin":0,"aria-valuemax":n,"aria-valuenow":s,"aria-valuetext":`${D(s)} of ${D(n)}`,tabIndex:0,onKeyDown:f=>{f.key==="ArrowRight"?r(Math.min(n,s+10)):f.key==="ArrowLeft"&&r(Math.max(0,s-10))},children:[e.jsx("div",{className:"absolute inset-y-0 left-0 bg-dark-500 rounded-full",style:{width:`${u}%`}}),e.jsx("div",{className:"absolute inset-y-0 left-0 bg-primary-500 rounded-full transition-all",style:{width:`${d}%`}}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -translate-x-1/2 w-4 h-4 bg-white rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",style:{left:`${d}%`}})]}),e.jsxs("div",{className:"flex justify-between mt-2 text-xs text-gray-400",children:[e.jsx("span",{children:D(s)}),e.jsx("span",{children:D(n)})]})]})}function fe({title:o,onPrevious:l,onNext:s,hasPrevious:n=!1,hasNext:r=!1,onClose:y}){const{isPlaying:b,isLoading:c,volume:i,playbackRate:d,isFullscreen:u,showOverlay:h,toggle:k,setVolume:g,setPlaybackRate:p,toggleFullscreen:m,showControls:w}=$(),j=h?"opacity-100":"opacity-0 pointer-events-none";return e.jsxs("div",{className:`absolute inset-0 transition-opacity duration-300 ${j}`,onMouseMove:w,onClick:w,children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-black/70 to-transparent",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-white text-lg font-medium truncate flex-1",children:o||"Content Viewer"}),y&&e.jsx("button",{onClick:y,className:"p-2 rounded-lg text-white/80 hover:text-white hover:bg-white/10 transition-colors","aria-label":"Close viewer",children:e.jsx(K,{className:"w-6 h-6"})})]})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("button",{onClick:k,disabled:c,className:"p-6 rounded-full bg-black/50 text-white hover:bg-black/70 transition-colors disabled:opacity-50","aria-label":b?"Pause":"Play",children:b?e.jsx(ne,{className:"w-12 h-12"}):e.jsx(G,{className:"w-12 h-12 ml-1"})})}),e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center",children:n&&e.jsx("button",{onClick:l,className:"p-4 text-white/80 hover:text-white hover:bg-white/10 transition-colors","aria-label":"Previous content",children:e.jsx(Z,{className:"w-8 h-8"})})}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center",children:r&&e.jsx("button",{onClick:s,className:"p-4 text-white/80 hover:text-white hover:bg-white/10 transition-colors","aria-label":"Next content",children:e.jsx(ee,{className:"w-8 h-8"})})}),e.jsx("div",{className:"absolute bottom-16 left-0 right-0 px-4 bg-gradient-to-t from-black/70 to-transparent",children:e.jsxs("div",{className:"flex items-center justify-between py-4",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-2 group",children:[e.jsx("button",{onClick:()=>g(i>0?0:1),className:"p-2 text-white/80 hover:text-white transition-colors","aria-label":i>0?"Mute":"Unmute",children:i>0?e.jsx(oe,{className:"w-5 h-5"}):e.jsx(re,{className:"w-5 h-5"})}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:i,onChange:f=>g(parseFloat(f.target.value)),className:"w-20 h-1 bg-white/30 rounded-full appearance-none cursor-pointer opacity-0 group-hover:opacity-100 transition-opacity [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:bg-white [&::-webkit-slider-thumb]:rounded-full","aria-label":"Volume"})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:d,onChange:f=>p(parseFloat(f.target.value)),className:"bg-transparent text-white/80 text-sm border-none cursor-pointer focus:outline-none","aria-label":"Playback speed",children:[e.jsx("option",{value:"0.5",className:"bg-dark-800",children:"0.5x"}),e.jsx("option",{value:"0.75",className:"bg-dark-800",children:"0.75x"}),e.jsx("option",{value:"1",className:"bg-dark-800",children:"1x"}),e.jsx("option",{value:"1.25",className:"bg-dark-800",children:"1.25x"}),e.jsx("option",{value:"1.5",className:"bg-dark-800",children:"1.5x"}),e.jsx("option",{value:"2",className:"bg-dark-800",children:"2x"})]}),e.jsx("button",{onClick:m,className:"p-2 text-white/80 hover:text-white transition-colors","aria-label":u?"Exit fullscreen":"Enter fullscreen",children:u?e.jsx(se,{className:"w-5 h-5"}):e.jsx(ae,{className:"w-5 h-5"})})]})]})})]})}function pe({content:o,contents:l,currentIndex:s,onNavigate:n}){const r=Y(),y=t.useRef(null),{toggle:b,seek:c,currentTime:i,duration:d,setVolume:u,volume:h,toggleFullscreen:k,toggleSeekbar:g,showSeekbar:p,showControls:m,isPlaying:w}=$(),j=s>0,f=s<l.length-1,E=t.useCallback(()=>{j&&n(s-1)},[j,s,n]),C=t.useCallback(()=>{f&&n(s+1)},[f,s,n]),a=t.useCallback(()=>{r(-1)},[r]),v=t.useCallback(()=>c(i+10),[c,i]),N=t.useCallback(()=>c(i-10),[c,i]),M=t.useCallback(()=>u(Math.min(1,h+.1)),[u,h]),S=t.useCallback(()=>u(Math.max(0,h-.1)),[u,h]),T=t.useCallback(()=>u(h>0?0:1),[u,h]),P=t.useCallback(()=>c(0),[c]),R=t.useCallback(()=>c(d),[c,d]),F=t.useMemo(()=>[{key:" ",action:b,description:"Play/Pause",category:"playback"},{key:"k",action:b,description:"Play/Pause",category:"playback"},{key:"ArrowRight",action:v,description:"Forward 10s",category:"playback"},{key:"ArrowLeft",action:N,description:"Backward 10s",category:"playback"},{key:"l",action:v,description:"Forward 10s",category:"playback"},{key:"j",action:N,description:"Backward 10s",category:"playback"},{key:"ArrowUp",action:M,description:"Volume Up",category:"playback"},{key:"ArrowDown",action:S,description:"Volume Down",category:"playback"},{key:"m",action:T,description:"Toggle Mute",category:"playback"},{key:"0",action:P,description:"Go to Start",category:"playback"},{key:"End",action:R,description:"Go to End",category:"playback"},{key:"n",action:C,description:"Next Content",category:"navigation"},{key:"p",action:E,description:"Previous Content",category:"navigation"},{key:"f",action:k,description:"Toggle Fullscreen",category:"ui"},{key:"Escape",action:a,description:"Close Viewer",category:"ui"},{key:"s",action:g,description:"Toggle Seekbar",category:"ui"}],[b,v,N,M,S,T,P,R,C,E,k,a,g]);ue(F);const V=t.useMemo(()=>({onSwipeLeft:C,onSwipeRight:E,onTap:m,onDoubleTap:k}),[C,E,m,k]),{ref:x}=de(V);t.useEffect(()=>{if(f){const z=l[s+1],X=new Audio;return X.preload="metadata",X.src=z.audioUrl,()=>{X.src=""}}},[s,l,f]);const O=t.useMemo(()=>`${o.title}, ${s+1} of ${l.length}${w?", playing":", paused"}`,[o.title,s,l.length,w]);return e.jsxs("div",{ref:y,className:"fixed inset-0 bg-dark-950 z-50",role:"application","aria-label":"Content Viewer",children:[e.jsx("div",{role:"status","aria-live":"polite","aria-atomic":"true",className:"sr-only",children:O}),e.jsxs("div",{ref:x,className:"relative w-full h-full",children:[e.jsx(he,{htmlUrl:o.htmlUrl}),e.jsx(fe,{title:o.title,onPrevious:E,onNext:C,hasPrevious:j,hasNext:f,onClose:a}),e.jsx(me,{collapsed:!p,onToggle:g})]})]})}function ye(o){return e.jsx(ce,{audioUrl:o.content.audioUrl,children:e.jsx(pe,{...o})})}function xe(){const{classroomId:o,contentId:l}=H(),[s,n]=t.useState([]),[r,y]=t.useState(0),[b,c]=t.useState(!0),{user:i}=q(),{addToast:d}=_(),u=Y();t.useEffect(()=>{(async()=>{if(o)try{c(!0);const m=await Q.getByClassroom(o);n(m);const w=m.findIndex(j=>j.id===l);if(w===-1){d("error","Content not found"),u(`/classrooms/${o}`);return}y(w)}catch{d("error","Failed to load content"),u(`/classrooms/${o}`)}finally{c(!1)}})()},[o,l,u,d]);const h=t.useCallback(async(p,m)=>{if(!(!i||!l||!o))try{await J.upsert({userId:i.uid,contentId:l,classroomId:o,currentTime:p,completed:m})}catch{}},[i,l,o]);t.useEffect(()=>{if(!i||!l||!o)return;const p=()=>{h(0,!1)};return window.addEventListener("beforeunload",p),()=>{window.removeEventListener("beforeunload",p)}},[i,l,o,h]);const k=t.useCallback(p=>{if(p>=0&&p<s.length){const m=s[p];u(`/viewer/${o}/${m.id}`,{replace:!0}),y(p)}},[s,o,u]),g=t.useMemo(()=>s[r],[s,r]);return b?e.jsx(A,{}):g?e.jsx(ye,{content:g,contents:s,currentIndex:r,onNavigate:k}):e.jsx(A,{})}export{xe as ViewerPage};
