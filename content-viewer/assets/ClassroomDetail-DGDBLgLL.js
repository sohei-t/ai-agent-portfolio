import{c as k,j as e,C,u as B,a as D,L as P,B as $}from"./index-N1P5ay2K.js";import{L as y,d as A,r as n}from"./router-DZPHsDLW.js";import{L as N,B as b}from"./Layout-B-RYqJTg.js";import{P as I}from"./play-BJpg_A95.js";import{c as E,a as z,p as T}from"./firestore-g5Y3pXIM.js";import"./firebase-B_HbBKsG.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=k("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=k("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);function F(t){const a=Math.floor(t/60),o=Math.floor(t%60);return`${a}:${o.toString().padStart(2,"0")}`}function H({contents:t,classroomId:a,progressMap:o}){return t.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-400",children:"No content available yet."})}):e.jsx("div",{className:"space-y-3",children:t.map((s,h)=>{const r=o?.get(s.id),i=r?.completed,u=r?.currentTime||0,l=s.duration>0?u/s.duration*100:0;return e.jsx(y,{to:`/viewer/${a}/${s.id}`,className:"block bg-dark-800 rounded-lg p-4 hover:bg-dark-700 transition-colors group",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-dark-700 flex items-center justify-center group-hover:bg-primary-500 transition-colors",children:[i?e.jsx(C,{className:"w-5 h-5 text-green-400"}):e.jsx("span",{className:"text-sm font-medium text-gray-400 group-hover:hidden",children:h+1}),e.jsx(I,{className:"w-5 h-5 text-white hidden group-hover:block"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-white font-medium truncate group-hover:text-primary-400 transition-colors",children:s.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-400",children:[e.jsx(L,{className:"w-3 h-3"}),F(s.duration)]}),r&&!i&&l>0&&e.jsxs("span",{className:"text-xs text-primary-400",children:[Math.round(l),"% complete"]})]}),r&&!i&&l>0&&e.jsx("div",{className:"mt-2 h-1 bg-dark-600 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary-500 rounded-full transition-all",style:{width:`${l}%`}})})]})]})},s.id)})})}function K(){const{classroomId:t}=A(),[a,o]=n.useState(null),[s,h]=n.useState([]),[r,i]=n.useState(new Map),[u,l]=n.useState(!0),{user:c}=B(),{addToast:p}=D();n.useEffect(()=>{(async()=>{if(t)try{l(!0);const m=await E.getById(t);if(!m){p("error","Classroom not found");return}o(m);const j=await z.getByClassroom(t);if(h(j),c){const d=await T.getByUserAndClassroom(c.uid,t),x=new Map;d.forEach(w=>x.set(w.contentId,w)),i(x)}}catch{p("error","Failed to load classroom")}finally{l(!1)}})()},[t,c,p]);const{completedCount:v,totalDuration:M,progressPercent:g}=n.useMemo(()=>{const f=Array.from(r.values()).filter(d=>d.completed).length,m=s.reduce((d,x)=>d+x.duration,0),j=s.length>0?f/s.length*100:0;return{completedCount:f,totalDuration:m,progressPercent:j}},[r,s]);if(u)return e.jsx(N,{children:e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(P,{size:"lg"})})});if(!a)return e.jsx(N,{children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-20 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Classroom Not Found"}),e.jsx(y,{to:"/classrooms",children:e.jsx($,{children:"Back to Classrooms"})})]})});const S=s.length===1?"content":"contents";return e.jsx(N,{children:e.jsxs("main",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",role:"main",children:[e.jsxs(y,{to:"/classrooms",className:"inline-flex items-center gap-2 text-gray-400 hover:text-white transition-colors mb-6 focus:outline-none focus:ring-2 focus:ring-primary-400 focus:ring-offset-2 focus:ring-offset-dark-900 rounded",children:[e.jsx(U,{className:"w-4 h-4","aria-hidden":"true"}),"Back to Classrooms"]}),e.jsxs("article",{className:"bg-dark-800 rounded-xl p-6 mb-8",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-20 h-20 bg-dark-700 rounded-lg flex items-center justify-center",children:a.thumbnailUrl?e.jsx("img",{src:a.thumbnailUrl,alt:"","aria-hidden":"true",className:"w-full h-full object-cover rounded-lg",loading:"lazy"}):e.jsx(b,{className:"w-8 h-8 text-dark-500","aria-hidden":"true"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:a.name}),e.jsx("p",{className:"text-gray-400 mt-1",children:a.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mt-4",role:"list",children:[e.jsxs("span",{className:"flex items-center gap-1 text-sm text-gray-400",role:"listitem",children:[e.jsx(b,{className:"w-4 h-4","aria-hidden":"true"}),e.jsxs("span",{children:[s.length," ",S]})]}),e.jsxs("span",{className:"flex items-center gap-1 text-sm text-gray-400",role:"listitem",children:[e.jsx(L,{className:"w-4 h-4","aria-hidden":"true"}),e.jsxs("span",{children:[Math.round(M/60)," min total"]})]}),c&&v>0&&e.jsxs("span",{className:"flex items-center gap-1 text-sm text-green-400",role:"listitem",children:[e.jsx(C,{className:"w-4 h-4","aria-hidden":"true"}),e.jsxs("span",{children:[v,"/",s.length," completed"]})]})]})]})]}),c&&s.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-400",id:"progress-label",children:"Your Progress"}),e.jsxs("span",{className:"text-primary-400",children:[Math.round(g),"%"]})]}),e.jsx("div",{className:"h-2 bg-dark-600 rounded-full overflow-hidden",role:"progressbar","aria-labelledby":"progress-label","aria-valuenow":Math.round(g),"aria-valuemin":0,"aria-valuemax":100,children:e.jsx("div",{className:"h-full bg-primary-500 rounded-full transition-all",style:{width:`${g}%`}})})]})]}),e.jsxs("section",{"aria-labelledby":"contents-heading",children:[e.jsx("h2",{id:"contents-heading",className:"text-lg font-semibold text-white mb-4",children:"Contents"}),e.jsx(H,{contents:s,classroomId:a.id,progressMap:r})]})]})})}export{K as ClassroomDetail};
