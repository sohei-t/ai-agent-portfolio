<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Cute Gradius - Horizontal Shooting Game</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      .hidden {
        display: none !important;
      }

      html, body {
        width: 100%;
        height: 100%;
      }

      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        font-family: 'Arial', sans-serif;
        margin: 0;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        touch-action: manipulation; /* ãƒšãƒ¼ã‚¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æŠ‘åˆ¶ã—ã¤ã¤ã‚¿ãƒƒãƒ—å„ªå…ˆ */
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      /* 16:9ã‚’ãƒ™ãƒ¼ã‚¹ã«ãƒ¬ã‚¿ãƒ¼ãƒœãƒƒã‚¯ã‚¹ã€‚å¤§ãã„ç”»é¢ã¯ä½™ç™½ã§åŸ‹ã‚ã‚‹ */
      #game-container {
        position: relative;
        width: 960px;
        height: 540px;
        max-width: 100vw;
        max-height: 56.25vw; /* 16:9 = 9/16 = 56.25% */
        overflow: hidden;
        touch-action: none; /* ã‚²ãƒ¼ãƒ æ“ä½œç”¨ã®ã‚¿ãƒƒãƒ—ã‚’å„ªå…ˆ */
        background: #000; /* ãƒ¬ã‚¿ãƒ¼ãƒœãƒƒã‚¯ã‚¹æ™‚ã®èƒŒæ™¯ */
      }

      /* Phaserã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ã‚³ãƒ³ãƒ†ãƒŠã„ã£ã±ã„ã«è¡¨ç¤ºï¼ˆæ¯”ç‡ã¯Phaserå´ã«ä»»ã›ã‚‹ï¼‰ */
      #game-container canvas {
        width: 100% !important;
        height: 100% !important;
        touch-action: none;
        display: block;
      }

      /* ãƒ¢ãƒã‚¤ãƒ«å‘ã‘ã®è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒ« */
      @media (max-width: 960px) {
        #game-container {
          width: 100vw;
          height: 56.25vw; /* 16:9 aspect ratio */
          max-height: 100vh;
        }
      }

      @media (max-height: 540px) {
        #game-container {
          width: 177.78vh; /* 16:9 = 16/9 = 1.7778 */
          height: 100vh;
          max-width: 100vw;
        }
      }

      /* æ¨ªå‘ãè­¦å‘Š */
      #orientation-warning {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        color: white;
        display: none;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        z-index: 9999;
        text-align: center;
      }

      #orientation-warning.show {
        display: flex;
      }

      #orientation-warning h1 {
        font-size: 2em;
        margin-bottom: 20px;
        animation: pulse 2s ease-in-out infinite;
      }

      #orientation-warning .rotate-icon {
        font-size: 5em;
        margin: 20px;
        animation: rotate 2s ease-in-out infinite;
      }

      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }

      @keyframes rotate {
        0% { transform: rotate(0deg); }
        50% { transform: rotate(90deg); }
        100% { transform: rotate(0deg); }
      }

      /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ */
      #loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 1.5em;
        text-align: center;
      }

      .loading-spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top: 4px solid white;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* UI ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
      #ui-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 100;
      }

      .power-meter {
        position: absolute;
        bottom: 20px; /* safe-area-insetã‚’ä¸€æ—¦å‰Šé™¤ã—ã¦ç¢ºå®Ÿã«è¡¨ç¤º */
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.7);
        padding: 8px 16px;
        border-radius: 20px;
        display: flex;
        gap: 6px;
        pointer-events: auto;  /* ã‚¿ãƒƒãƒå¯èƒ½ã«å¤‰æ›´ */
        flex-wrap: nowrap;  /* 1è¡Œã«å›ºå®š */
        touch-action: none; /* ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã‚ºãƒ¼ãƒ æŠ‘åˆ¶ */
        white-space: nowrap;
        z-index: 1000; /* ç¢ºå®Ÿã«æœ€å‰é¢ã« */
      }

      .power-item {
        padding: 4px 8px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 5px;
        color: white;
        font-size: 11px;
        transition: all 0.3s;
        cursor: pointer;
        user-select: none;
        -webkit-user-select: none;
        -webkit-tap-highlight-color: transparent;
        flex-shrink: 0;  /* ã‚¢ã‚¤ãƒ†ãƒ ãŒç¸®å°ã—ãªã„ã‚ˆã†ã« */
      }

      .power-item:active {
        transform: scale(0.95);
      }

      .power-item.active {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        transform: scale(1.1);
        box-shadow: 0 0 20px rgba(245, 87, 108, 0.5);
      }

      .power-item.selected {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        animation: blink 0.5s ease-in-out infinite;
      }

      @keyframes blink {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }

      /* ãƒ¢ãƒã‚¤ãƒ«ãƒœã‚¿ãƒ³ */
      #mobile-controls {
        position: absolute;
        bottom: 80px; /* ãƒ‘ãƒ¯ãƒ¼ãƒ¡ãƒ¼ã‚¿ãƒ¼ã®ä¸Šã«é…ç½® */
        left: 16px; /* å·¦é…ç½®ã«å¤‰æ›´ */
        display: none;
        pointer-events: auto;
        z-index: 1000; /* ç¢ºå®Ÿã«æœ€å‰é¢ã« */
      }

      /* ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³è¨±å¯ãƒœã‚¿ãƒ³ */
      #motion-permission {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: #fff;
        padding: 8px 12px;
        border-radius: 8px;
        font-size: 12px;
        cursor: pointer;
        pointer-events: auto;
        z-index: 200;
        user-select: none;
        -webkit-user-select: none;
      }

      .touch-button {
        width: 68px;
        height: 68px;
        background: rgba(255, 255, 255, 0.35);
        border: 3px solid white;
        border-radius: 50%;
        color: white;
        font-size: 14px;
        font-weight: bold;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        transition: all 0.2s;
        touch-action: none; /* ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã‚ºãƒ¼ãƒ æŠ‘åˆ¶ */
      }

      .touch-button:active {
        transform: scale(0.9);
        background: rgba(255, 255, 255, 0.5);
      }

      @media (max-width: 900px) {
        .power-meter {
          bottom: 14px; /* ãƒ¢ãƒã‚¤ãƒ«ã§ã‚‚ç¢ºå®Ÿã«è¡¨ç¤º */
          left: 50%;
          transform: translateX(-50%);
          gap: 4px;
          padding: 6px 10px;
          flex-wrap: nowrap;  /* ãƒ¢ãƒã‚¤ãƒ«ã§ã‚‚1è¡Œ */
        }
        .power-item {
          font-size: 10px;
          padding: 3px 6px;
        }
        #mobile-controls {
          display: block;
          bottom: 70px; /* ãƒ‘ãƒ¯ãƒ¼ãƒ¡ãƒ¼ã‚¿ãƒ¼ã®ä¸Š */
        }
        .touch-button {
          width: 70px;
          height: 70px;
          font-size: 12px;
        }
      }
    </style>
    <script type="module" crossorigin src="/ai-agent-portfolio/gradius-clone/assets/index-GooseoXw.js"></script>
  </head>
  <body>
    <!-- æ¨ªå‘ãè­¦å‘Š -->
    <div id="orientation-warning">
      <div class="rotate-icon">ğŸ“±</div>
      <h1>Please Rotate Your Device</h1>
      <p>This game is best played in landscape mode</p>
    </div>

    <!-- ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="game-container">
      <div id="loading">
        <div class="loading-spinner"></div>
        <p>Loading Cute Gradius...</p>
      </div>

      <!-- UI ã¯ã™ã¹ã¦ Canvas å†…ã«æç”» -->
    </div>

    <script>
      // æ¨ªå‘ãæ¤œå‡º
      function checkOrientation() {
        const warning = document.getElementById('orientation-warning');
        const isPortrait = window.innerHeight > window.innerWidth;

        if (isPortrait) {
          warning.classList.add('show');
        } else {
          warning.classList.remove('show');
        }
      }

      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
      window.addEventListener('resize', checkOrientation);
      window.addEventListener('orientationchange', checkOrientation);

      // åˆæœŸãƒã‚§ãƒƒã‚¯
      checkOrientation();

      // ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹å‘ã‘ï¼šã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã‚’é˜²ã
      document.addEventListener('touchmove', function(e) {
        if (e.target.closest('#game-container')) {
          e.preventDefault();
        }
      }, { passive: false });

      // åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ã«ã‚²ãƒ¼ãƒ ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ç¾åœ¨ã®ç”»é¢ã‚µã‚¤ã‚ºã«ãƒªã‚µã‚¤ã‚º
      document.addEventListener('DOMContentLoaded', () => {
        const resizeGame = () => {
          const evt = new Event('resize');
          window.dispatchEvent(evt);
        };
        // å°‘ã—é…å»¶ã—ã¦2å›å‘¼ã¶ã“ã¨ã§ãƒ¢ãƒã‚¤ãƒ«ã®åˆæœŸãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¤‰åŒ–ã«ã‚‚è¿½å¾“
        resizeGame();
        setTimeout(resizeGame, 300);
        setTimeout(resizeGame, 800);
        // ç«¯æœ«å‘ãã®å¤‰åŒ–ã«ã‚‚è¿½å¾“
        window.addEventListener('orientationchange', () => {
          setTimeout(resizeGame, 100);
          setTimeout(resizeGame, 500);
        });
      });
    </script>

    <!-- ã‚¸ãƒ£ã‚¤ãƒ­è¨±å¯ã®äº‹å‰è¨­å®šï¼ˆiOS 18å¯¾å¿œï¼‰ -->
    <script>
      // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã§ã‚¸ãƒ£ã‚¤ãƒ­çŠ¶æ…‹ã‚’ç®¡ç†
      window.gyroPermissionStatus = 'pending';
      window.gyroEnabled = false;
      window.gyroData = { x: 0, y: 0 };

      // ã‚¸ãƒ£ã‚¤ãƒ­è¨±å¯ã‚’äº‹å‰ã«è¨­å®šï¼ˆã‚²ãƒ¼ãƒ å†…ã‹ã‚‰å‘¼ã³å‡ºã—å¯èƒ½ï¼‰
      window.requestGyroPermission = async function() {
        console.log('[Gyro] Permission request initiated from inline script');

        if (typeof DeviceOrientationEvent !== 'undefined' &&
            typeof DeviceOrientationEvent.requestPermission === 'function') {
          try {
            // ç›´æ¥requestPermissionã‚’å‘¼ã¶ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå†…ï¼‰
            const permission = await DeviceOrientationEvent.requestPermission();
            console.log('[Gyro] Permission result:', permission);

            if (permission === 'granted') {
              window.gyroPermissionStatus = 'granted';
              window.gyroEnabled = true;

              // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ç™»éŒ²
              window.addEventListener('deviceorientation', function(event) {
                if (!window.gyroEnabled) return;

                const { beta, gamma } = event;
                if (beta === null || gamma === null) return;

                const isLandscape = window.innerWidth > window.innerHeight;
                const maxTilt = 20;
                const sensitivity = 2.5;

                if (isLandscape) {
                  window.gyroData.x = (beta / maxTilt) * sensitivity;
                  window.gyroData.y = -(gamma / maxTilt) * sensitivity;
                } else {
                  window.gyroData.x = (gamma / maxTilt) * sensitivity;
                  window.gyroData.y = -(beta / maxTilt) * sensitivity;
                }

                // ã‚¯ãƒ©ãƒ³ãƒ—
                window.gyroData.x = Math.max(-1, Math.min(1, window.gyroData.x));
                window.gyroData.y = Math.max(-1, Math.min(1, window.gyroData.y));
              });

              return true;
            } else {
              window.gyroPermissionStatus = 'denied';
              return false;
            }
          } catch (error) {
            console.error('[Gyro] Permission error:', error);
            window.gyroPermissionStatus = 'error';
            return false;
          }
        } else {
          // Android/å¤ã„iOS - è‡ªå‹•çš„ã«æœ‰åŠ¹
          window.gyroPermissionStatus = 'granted';
          window.gyroEnabled = true;

          window.addEventListener('deviceorientation', function(event) {
            if (!window.gyroEnabled) return;

            const { beta, gamma } = event;
            if (beta === null || gamma === null) return;

            const isLandscape = window.innerWidth > window.innerHeight;
            const maxTilt = 20;
            const sensitivity = 2.5;

            if (isLandscape) {
              window.gyroData.x = (beta / maxTilt) * sensitivity;
              window.gyroData.y = -(gamma / maxTilt) * sensitivity;
            } else {
              window.gyroData.x = (gamma / maxTilt) * sensitivity;
              window.gyroData.y = -(beta / maxTilt) * sensitivity;
            }

            window.gyroData.x = Math.max(-1, Math.min(1, window.gyroData.x));
            window.gyroData.y = Math.max(-1, Math.min(1, window.gyroData.y));
          });

          return true;
        }
      };
    </script>

  </body>
</html>
